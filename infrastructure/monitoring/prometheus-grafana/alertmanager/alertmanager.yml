global:
  smtp_smarthost: 'localhost:587'
  smtp_from: 'alerts@writewave.com'
  smtp_auth_username: 'alerts@writewave.com'
  smtp_auth_password: 'your-email-password'

route:
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1h
  receiver: 'web.hook'
  routes:
  - match:
      severity: critical
    receiver: 'pagerduty'
    group_wait: 10s
    repeat_interval: 5m
  - match:
      severity: warning
    receiver: 'slack'
    group_wait: 30s
    repeat_interval: 30m
  - match:
      component: security
    receiver: 'security-team'
    group_wait: 5s
    repeat_interval: 5m
  - match:
      component: business
    receiver: 'business-team'
    group_wait: 1m
    repeat_interval: 1h

receivers:
- name: 'web.hook'
  webhook_configs:
  - url: 'http://webhook:5001/'

- name: 'pagerduty'
  pagerduty_configs:
  - service_key: 'your-pagerduty-service-key'
    description: '{{ .GroupLabels.alertname }}: {{ .CommonAnnotations.summary }}'
    details:
      firing: '{{ .Alerts.Firing | len }}'
      resolved: '{{ .Alerts.Resolved | len }}'
      group_labels: '{{ range .GroupLabels.SortedPairs }}{{ .Name }}={{ .Value }} {{ end }}'
      common_labels: '{{ range .CommonLabels.SortedPairs }}{{ .Name }}={{ .Value }} {{ end }}'
      common_annotations: '{{ range .CommonAnnotations.SortedPairs }}{{ .Name }}={{ .Value }} {{ end }}'
      runbook_url: '{{ .CommonAnnotations.runbook_url }}'

- name: 'slack'
  slack_configs:
  - api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'
    channel: '#alerts'
    title: 'WriteWave Alert: {{ .GroupLabels.alertname }}'
    text: |
      {{ range .Alerts }}
      *Alert:* {{ .Annotations.summary }}
      *Description:* {{ .Annotations.description }}
      *Severity:* {{ .Labels.severity }}
      *Service:* {{ .Labels.service }}
      *Runbook:* {{ .Annotations.runbook_url }}
      {{ end }}
    send_resolved: true

- name: 'email'
  email_configs:
  - to: 'alerts@writewave.com'
    subject: 'WriteWave Alert: {{ .GroupLabels.alertname }}'
    body: |
      {{ range .Alerts }}
      Alert: {{ .Annotations.summary }}
      Description: {{ .Annotations.description }}
      Severity: {{ .Labels.severity }}
      Service: {{ .Labels.service }}
      Runbook: {{ .Annotations.runbook_url }}
      
      Labels:
      {{ range .Labels.SortedPairs }}
        {{ .Name }}: {{ .Value }}
      {{ end }}
      
      Annotations:
      {{ range .Annotations.SortedPairs }}
        {{ .Name }}: {{ .Value }}
      {{ end }}
      {{ end }}

- name: 'security-team'
  pagerduty_configs:
  - service_key: 'your-security-pagerduty-key'
    description: 'SECURITY ALERT: {{ .GroupLabels.alertname }}'
    details:
      severity: '{{ .CommonLabels.severity }}'
      component: '{{ .CommonLabels.component }}'
      runbook_url: '{{ .CommonAnnotations.runbook_url }}'
  email_configs:
  - to: 'security@writewave.com'
    subject: 'SECURITY ALERT: {{ .GroupLabels.alertname }}'
    body: |
      SECURITY ALERT DETECTED
      
      {{ range .Alerts }}
      Alert: {{ .Annotations.summary }}
      Description: {{ .Annotations.description }}
      Severity: {{ .Labels.severity }}
      Component: {{ .Labels.component }}
      Runbook: {{ .Annotations.runbook_url }}
      {{ end }}

- name: 'business-team'
  slack_configs:
  - api_url: 'https://hooks.slack.com/services/YOUR/BUSINESS/WEBHOOK'
    channel: '#business-alerts'
    title: 'Business Alert: {{ .GroupLabels.alertname }}'
    text: |
      {{ range .Alerts }}
      *Alert:* {{ .Annotations.summary }}
      *Description:* {{ .Annotations.description }}
      *Impact:* Business metrics affected
      *Runbook:* {{ .Annotations.runbook_url }}
      {{ end }}
  email_configs:
  - to: 'business@writewave.com'
    subject: 'Business Alert: {{ .GroupLabels.alertname }}'
    body: |
      Business metrics alert detected
      
      {{ range .Alerts }}
      Alert: {{ .Annotations.summary }}
      Description: {{ .Annotations.description }}
      Runbook: {{ .Annotations.runbook_url }}
      {{ end }}

inhibit_rules:
- source_match:
    severity: 'critical'
  target_match:
    severity: 'warning'
  equal: ['alertname', 'cluster', 'service']
