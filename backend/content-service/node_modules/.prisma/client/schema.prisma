// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Character types enum
enum CharacterType {
  HIRAGANA
  KATAKANA
  KANJI
}

// JLPT levels enum
enum JLPTLevel {
  N5
  N4
  N3
  N2
  N1
}

// Difficulty levels enum
enum DifficultyLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  EXPERT
}

// Media types enum
enum MediaType {
  IMAGE
  AUDIO
  VIDEO
  ANIMATION
}

// Lesson types enum
enum LessonType {
  CHARACTER_LEARNING
  VOCABULARY_LEARNING
  GRAMMAR_LEARNING
  READING_PRACTICE
  LISTENING_PRACTICE
  WRITING_PRACTICE
}

// Vocabulary categories enum
enum VocabularyCategory {
  FOOD
  TRAVEL
  FAMILY
  WORK
  EDUCATION
  HEALTH
  SPORTS
  ENTERTAINMENT
  TECHNOLOGY
  NATURE
  CLOTHING
  COLORS
  NUMBERS
  TIME
  WEATHER
  EMOTIONS
  ACTIONS
  ADJECTIVES
  VERBS
  NOUNS
  OTHER
}

// Characters table
model Character {
  id              String          @id @default(cuid())
  character       String          @unique
  type            CharacterType
  jlptLevel       JLPTLevel?
  difficultyLevel DifficultyLevel @default(BEGINNER)

  // Basic information
  meaning       String?
  pronunciation String?
  romanization  String?

  // Stroke information
  strokeCount    Int?
  strokeOrder    Json? // Array of stroke paths
  strokePatterns Json? // Stroke pattern data

  // Readings
  kunyomi String[] @default([])
  onyomi  String[] @default([])

  // Radical information
  radical        String?
  radicalMeaning String?

  // Examples and usage
  examples   Json? // Array of example words/phrases
  usageNotes String?

  // Learning progression
  learningOrder Int?
  isActive      Boolean @default(true)

  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  mediaAssets        MediaAsset[]
  vocabularyWords    VocabularyWord[]
  lessons            Lesson[]
  characterRelations CharacterRelation[] @relation("CharacterRelations")
  relatedCharacters  CharacterRelation[] @relation("RelatedCharacters")

  @@index([type])
  @@index([jlptLevel])
  @@index([difficultyLevel])
  @@index([isActive])
  @@index([learningOrder])
  @@map("characters")
}

// Character relationships (radicals, compounds, etc.)
model CharacterRelation {
  id                 String  @id @default(cuid())
  characterId        String
  relatedCharacterId String
  relationType       String // "radical", "compound", "variant", "similar"
  description        String?

  character        Character @relation("CharacterRelations", fields: [characterId], references: [id], onDelete: Cascade)
  relatedCharacter Character @relation("RelatedCharacters", fields: [relatedCharacterId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([characterId, relatedCharacterId, relationType])
  @@map("character_relations")
}

// Vocabulary words table
model VocabularyWord {
  id              String             @id @default(cuid())
  japanese        String
  romanization    String?
  english         String
  category        VocabularyCategory @default(OTHER)
  jlptLevel       JLPTLevel?
  difficultyLevel DifficultyLevel    @default(BEGINNER)

  // Additional information
  partOfSpeech  String? // noun, verb, adjective, etc.
  pronunciation String?
  audioUrl      String?

  // Usage and context
  exampleSentences Json? // Array of example sentences
  usageNotes       String?
  culturalNotes    String?

  // Learning data
  frequency Int? // Word frequency ranking
  isActive  Boolean @default(true)

  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  characters  Character[]
  lessons     Lesson[]
  mediaAssets MediaAsset[]

  @@index([category])
  @@index([jlptLevel])
  @@index([difficultyLevel])
  @@index([frequency])
  @@index([isActive])
  @@map("vocabulary_words")
}

// Lessons table
model Lesson {
  id              String          @id @default(cuid())
  title           String
  description     String?
  type            LessonType
  jlptLevel       JLPTLevel?
  difficultyLevel DifficultyLevel @default(BEGINNER)

  // Content
  content       Json? // Lesson content structure
  objectives    String[] @default([])
  prerequisites String[] @default([])

  // Learning progression
  estimatedTime Int? // Estimated time in minutes
  learningOrder Int?
  isActive      Boolean @default(true)

  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  characters      Character[]
  vocabularyWords VocabularyWord[]
  mediaAssets     MediaAsset[]

  @@index([type])
  @@index([jlptLevel])
  @@index([difficultyLevel])
  @@index([learningOrder])
  @@index([isActive])
  @@map("lessons")
}

// Media assets table
model MediaAsset {
  id           String    @id @default(cuid())
  filename     String
  originalName String
  mimeType     String
  size         Int
  type         MediaType

  // File information
  url          String
  thumbnailUrl String?
  altText      String?
  description  String?

  // Metadata
  width    Int?
  height   Int?
  duration Int? // For audio/video files

  // Relations
  characterId      String?
  vocabularyWordId String?
  lessonId         String?

  character      Character?      @relation(fields: [characterId], references: [id], onDelete: Cascade)
  vocabularyWord VocabularyWord? @relation(fields: [vocabularyWordId], references: [id], onDelete: Cascade)
  lesson         Lesson?         @relation(fields: [lessonId], references: [id], onDelete: Cascade)

  // System fields
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([type])
  @@index([characterId])
  @@index([vocabularyWordId])
  @@index([lessonId])
  @@index([isActive])
  @@map("media_assets")
}

// Learning progress tracking (optional, for future use)
model LearningProgress {
  id               String  @id @default(cuid())
  userId           String
  characterId      String?
  vocabularyWordId String?
  lessonId         String?

  // Progress data
  masteryLevel  Int       @default(0) // 0-100
  attempts      Int       @default(0)
  lastAttempted DateTime?
  lastMastered  DateTime?

  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, characterId, vocabularyWordId, lessonId])
  @@map("learning_progress")
}
