_format_version: "3.0"

# Production Kong configuration - Routes to actual backend services via host.docker.internal
services:
  # User Service - Routes to user-service-dev running on host
  - name: user-service
    url: http://host.docker.internal:8001
    routes:
      - name: user-service-v1
        paths:
          - /api/v1/users
          - /api/v1/auth
        methods:
          - GET
          - POST
          - PUT
          - DELETE
          - PATCH
        plugins:
          - name: cors
            config:
              origins:
                - http://localhost:3000
                - http://localhost:8080
                - https://writewave.app
              methods:
                - GET
                - POST
                - PUT
                - DELETE
                - PATCH
                - OPTIONS
              headers:
                - Authorization
                - Content-Type
                - Accept
              credentials: true
              max_age: 3600
          - name: rate-limiting
            config:
              minute: 100
              hour: 1000
          - name: request-transformer
            config:
              add:
                headers:
                  - "X-Service: user-service"
          - name: response-transformer
            config:
              add:
                headers:
                  - "X-Service: user-service"
                  - "X-Version: v1"

  # Content Service
  - name: content-service
    url: http://host.docker.internal:8002
    routes:
      - name: content-service-v1
        paths:
          - /api/v1/content
          - /api/v1/characters
          - /api/v1/kanji
          - /api/v1/hiragana
          - /api/v1/katakana
        methods:
          - GET
          - POST
          - PUT
          - DELETE
          - PATCH
        plugins:
          - name: cors
            config:
              origins:
                - http://localhost:3000
                - http://localhost:8080
                - https://writewave.app
              methods:
                - GET
                - POST
                - PUT
                - DELETE
                - PATCH
                - OPTIONS
              headers:
                - Authorization
                - Content-Type
              credentials: true
          - name: rate-limiting
            config:
              minute: 100
              hour: 1000
          - name: response-transformer
            config:
              add:
                headers:
                  - "X-Service: content-service"

  # Progress Service
  - name: progress-service
    url: http://host.docker.internal:8003
    routes:
      - name: progress-service-v1
        paths:
          - /api/v1/progress
          - /api/v1/achievements
          - /api/v1/stats
        methods:
          - GET
          - POST
          - PUT
          - DELETE
        plugins:
          - name: cors
            config:
              origins:
                - http://localhost:3000
                - http://localhost:8080
                - https://writewave.app
              credentials: true
          - name: rate-limiting
            config:
              minute: 100
              hour: 1000
          - name: response-transformer
            config:
              add:
                headers:
                  - "X-Service: progress-service"

  # Community Service
  - name: community-service
    url: http://host.docker.internal:8004
    routes:
      - name: community-service-v1
        paths:
          - /api/v1/community
          - /api/v1/discussions
          - /api/v1/groups
          - /api/v1/leaderboard
        methods:
          - GET
          - POST
          - PUT
          - DELETE
        plugins:
          - name: cors
            config:
              origins:
                - http://localhost:3000
                - http://localhost:8080
                - https://writewave.app
              credentials: true
          - name: rate-limiting
            config:
              minute: 100
              hour: 1000
          - name: response-transformer
            config:
              add:
                headers:
                  - "X-Service: community-service"

  # Notification Service
  - name: notification-service
    url: http://host.docker.internal:8005
    routes:
      - name: notification-service-v1
        paths:
          - /api/v1/notifications
        methods:
          - GET
          - POST
          - PUT
          - DELETE
        plugins:
          - name: cors
            config:
              origins:
                - http://localhost:3000
                - http://localhost:8080
                - https://writewave.app
              credentials: true
          - name: rate-limiting
            config:
              minute: 100
              hour: 1000
          - name: response-transformer
            config:
              add:
                headers:
                  - "X-Service: notification-service"

  # Analytics Service
  - name: analytics-service
    url: http://host.docker.internal:8006
    routes:
      - name: analytics-service-v1
        paths:
          - /api/v1/analytics
          - /api/v1/metrics
          - /api/v1/reports
        methods:
          - GET
          - POST
          - PUT
          - DELETE
        plugins:
          - name: cors
            config:
              origins:
                - http://localhost:3000
                - http://localhost:8080
                - https://writewave.app
              credentials: true
          - name: rate-limiting
            config:
              minute: 100
              hour: 1000
          - name: response-transformer
            config:
              add:
                headers:
                  - "X-Service: analytics-service"

  # Articles Service
  - name: articles-service
    url: http://host.docker.internal:8007
    routes:
      - name: articles-service-v1
        paths:
          - /api/articles
          - /api/v1/articles
        methods:
          - GET
          - POST
          - PUT
          - DELETE
          - PATCH
        plugins:
          - name: cors
            config:
              origins:
                - http://localhost:3000
                - http://localhost:8080
                - https://writewave.app
              credentials: true
          - name: rate-limiting
            config:
              minute: 100
              hour: 1000
          - name: response-transformer
            config:
              add:
                headers:
                  - "X-Service: articles-service"
                  - "X-Port: 8007"

# Global plugins - removed custom plugins that aren't enabled
# Using only bundled Kong plugins