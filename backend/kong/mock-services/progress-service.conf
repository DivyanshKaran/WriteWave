server {
    listen 80;
    server_name localhost;

    # Health check endpoint
    location /health {
        access_log off;
        return 200 '{"status": "healthy", "timestamp": "$time_iso8601", "service": "progress-service"}';
        add_header Content-Type application/json;
    }

    # Progress endpoints
    location /api/v1/progress {
        if ($request_method = OPTIONS) {
            add_header Access-Control-Allow-Origin "*";
            add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS";
            add_header Access-Control-Allow-Headers "Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Authorization";
            add_header Access-Control-Max-Age 3600;
            add_header Content-Length 0;
            add_header Content-Type text/plain;
            return 204;
        }

        if ($request_method = GET) {
            return 200 '{"progress": [{"id": 1, "user_id": 1, "character": "一", "type": "kanji", "completed": true, "accuracy": 95, "time_spent": 120}, {"id": 2, "user_id": 1, "character": "あ", "type": "hiragana", "completed": false, "accuracy": 0, "time_spent": 0}], "total": 2}';
            add_header Content-Type application/json;
        }

        if ($request_method = POST) {
            return 201 '{"id": 3, "user_id": 1, "character": "ア", "type": "katakana", "completed": true, "accuracy": 90, "time_spent": 90, "created": true}';
            add_header Content-Type application/json;
        }

        if ($request_method = PUT) {
            return 200 '{"id": 1, "user_id": 1, "character": "一", "type": "kanji", "completed": true, "accuracy": 98, "time_spent": 150, "updated": true}';
            add_header Content-Type application/json;
        }
    }

    # Achievements endpoints
    location /api/v1/achievements {
        if ($request_method = OPTIONS) {
            add_header Access-Control-Allow-Origin "*";
            add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS";
            add_header Access-Control-Allow-Headers "Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Authorization";
            add_header Access-Control-Max-Age 3600;
            add_header Content-Length 0;
            add_header Content-Type text/plain;
            return 204;
        }

        if ($request_method = GET) {
            return 200 '{"achievements": [{"id": 1, "user_id": 1, "title": "First Steps", "description": "Complete your first character", "earned": true, "earned_at": "2024-01-01T00:00:00Z"}, {"id": 2, "user_id": 1, "title": "Speed Demon", "description": "Complete 10 characters in under 5 minutes", "earned": false, "earned_at": null}], "total": 2}';
            add_header Content-Type application/json;
        }

        if ($request_method = POST) {
            return 201 '{"id": 3, "user_id": 1, "title": "New Achievement", "description": "A new achievement earned", "earned": true, "earned_at": "2024-01-01T00:00:00Z", "created": true}';
            add_header Content-Type application/json;
        }
    }

    # Stats endpoints
    location /api/v1/stats {
        if ($request_method = OPTIONS) {
            add_header Access-Control-Allow-Origin "*";
            add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS";
            add_header Access-Control-Allow-Headers "Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Authorization";
            add_header Access-Control-Max-Age 3600;
            add_header Content-Length 0;
            add_header Content-Type text/plain;
            return 204;
        }

        if ($request_method = GET) {
            return 200 '{"stats": {"user_id": 1, "total_characters": 50, "completed_characters": 45, "total_time": 3600, "average_accuracy": 92, "streak_days": 7, "level": 5, "xp": 1250}}';
            add_header Content-Type application/json;
        }

        if ($request_method = PUT) {
            return 200 '{"user_id": 1, "total_characters": 51, "completed_characters": 46, "total_time": 3720, "average_accuracy": 93, "streak_days": 8, "level": 5, "xp": 1300, "updated": true}';
            add_header Content-Type application/json;
        }
    }

    # Default location
    location / {
        return 200 '{"message": "Progress Service", "endpoints": ["/health", "/api/v1/progress", "/api/v1/achievements", "/api/v1/stats"]}';
        add_header Content-Type application/json;
    }
}
