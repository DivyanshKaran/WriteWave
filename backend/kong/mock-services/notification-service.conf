server {
    listen 80;
    server_name localhost;

    # Health check endpoint
    location /health {
        access_log off;
        return 200 '{"status": "healthy", "timestamp": "$time_iso8601", "service": "notification-service"}';
        add_header Content-Type application/json;
    }

    # Notifications endpoints
    location /api/v1/notifications {
        if ($request_method = OPTIONS) {
            add_header Access-Control-Allow-Origin "*";
            add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS";
            add_header Access-Control-Allow-Headers "Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Authorization";
            add_header Access-Control-Max-Age 3600;
            add_header Content-Length 0;
            add_header Content-Type text/plain;
            return 204;
        }

        if ($request_method = GET) {
            return 200 '{"notifications": [{"id": 1, "user_id": 1, "title": "Daily Practice Reminder", "message": "Time for your daily kanji practice!", "type": "reminder", "read": false, "created_at": "2024-01-01T00:00:00Z"}, {"id": 2, "user_id": 1, "title": "Achievement Unlocked", "message": "You have completed 10 kanji characters!", "type": "achievement", "read": true, "created_at": "2024-01-02T00:00:00Z"}], "total": 2}';
            add_header Content-Type application/json;
        }

        if ($request_method = POST) {
            return 201 '{"id": 3, "user_id": 1, "title": "New Notification", "message": "This is a new notification", "type": "info", "read": false, "created_at": "2024-01-03T00:00:00Z", "created": true}';
            add_header Content-Type application/json;
        }

        if ($request_method = PUT) {
            return 200 '{"id": 1, "user_id": 1, "title": "Daily Practice Reminder", "message": "Time for your daily kanji practice!", "type": "reminder", "read": true, "created_at": "2024-01-01T00:00:00Z", "updated": true}';
            add_header Content-Type application/json;
        }

        if ($request_method = DELETE) {
            return 200 '{"deleted": true, "id": 1}';
            add_header Content-Type application/json;
        }
    }

    # WebSocket endpoints
    location /api/v1/websocket {
        if ($request_method = OPTIONS) {
            add_header Access-Control-Allow-Origin "*";
            add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS";
            add_header Access-Control-Allow-Headers "Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Authorization";
            add_header Access-Control-Max-Age 3600;
            add_header Content-Length 0;
            add_header Content-Type text/plain;
            return 204;
        }

        if ($request_method = GET) {
            return 200 '{"websocket": {"url": "ws://localhost:8005/ws", "status": "available", "connections": 5}}';
            add_header Content-Type application/json;
        }
    }

    # Default location
    location / {
        return 200 '{"message": "Notification Service", "endpoints": ["/health", "/api/v1/notifications", "/api/v1/websocket"]}';
        add_header Content-Type application/json;
    }
}
