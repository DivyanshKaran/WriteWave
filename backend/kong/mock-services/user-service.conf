server {
    listen 80;
    server_name localhost;

    # Health check endpoint
    location /health {
        access_log off;
        return 200 '{"status": "healthy", "timestamp": "$time_iso8601", "service": "user-service"}';
        add_header Content-Type application/json;
    }

    # User endpoints
    location /api/v1/users {
        if ($request_method = OPTIONS) {
            add_header Access-Control-Allow-Origin "*";
            add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS";
            add_header Access-Control-Allow-Headers "Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Authorization";
            add_header Access-Control-Max-Age 3600;
            add_header Content-Length 0;
            add_header Content-Type text/plain;
            return 204;
        }

        if ($request_method = GET) {
            return 200 '{"users": [{"id": 1, "name": "John Doe", "email": "john@example.com"}, {"id": 2, "name": "Jane Smith", "email": "jane@example.com"}], "total": 2}';
            add_header Content-Type application/json;
        }

        if ($request_method = POST) {
            return 201 '{"id": 3, "name": "New User", "email": "new@example.com", "created": true}';
            add_header Content-Type application/json;
        }

        if ($request_method = PUT) {
            return 200 '{"id": 1, "name": "Updated User", "email": "updated@example.com", "updated": true}';
            add_header Content-Type application/json;
        }

        if ($request_method = DELETE) {
            return 200 '{"deleted": true, "id": 1}';
            add_header Content-Type application/json;
        }
    }

    # Auth endpoints
    location /api/v1/auth {
        if ($request_method = OPTIONS) {
            add_header Access-Control-Allow-Origin "*";
            add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS";
            add_header Access-Control-Allow-Headers "Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Authorization";
            add_header Access-Control-Max-Age 3600;
            add_header Content-Length 0;
            add_header Content-Type text/plain;
            return 204;
        }

        if ($request_method = POST) {
            return 200 '{"token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c", "user": {"id": 1, "name": "John Doe", "email": "john@example.com"}}';
            add_header Content-Type application/json;
        }

        if ($request_method = GET) {
            return 200 '{"authenticated": true, "user": {"id": 1, "name": "John Doe", "email": "john@example.com"}}';
            add_header Content-Type application/json;
        }
    }

    # Default location
    location / {
        return 200 '{"message": "User Service", "endpoints": ["/health", "/api/v1/users", "/api/v1/auth"]}';
        add_header Content-Type application/json;
    }
}
