server {
    listen 80;
    server_name localhost;

    # Health check endpoint
    location /health {
        access_log off;
        return 200 '{"status": "healthy", "timestamp": "$time_iso8601", "service": "community-service"}';
        add_header Content-Type application/json;
    }

    # Community endpoints
    location /api/v1/community {
        if ($request_method = OPTIONS) {
            add_header Access-Control-Allow-Origin "*";
            add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS";
            add_header Access-Control-Allow-Headers "Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Authorization";
            add_header Access-Control-Max-Age 3600;
            add_header Content-Length 0;
            add_header Content-Type text/plain;
            return 204;
        }

        if ($request_method = GET) {
            return 200 '{"community": {"total_users": 1000, "active_users": 150, "total_posts": 500, "total_groups": 25}}';
            add_header Content-Type application/json;
        }
    }

    # Discussions endpoints
    location /api/v1/discussions {
        if ($request_method = OPTIONS) {
            add_header Access-Control-Allow-Origin "*";
            add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS";
            add_header Access-Control-Allow-Headers "Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Authorization";
            add_header Access-Control-Max-Age 3600;
            add_header Content-Length 0;
            add_header Content-Type text/plain;
            return 204;
        }

        if ($request_method = GET) {
            return 200 '{"discussions": [{"id": 1, "title": "How to practice kanji effectively", "author": "John Doe", "content": "I have been practicing kanji for a month now...", "replies": 5, "created_at": "2024-01-01T00:00:00Z"}, {"id": 2, "title": "Best resources for hiragana", "author": "Jane Smith", "content": "Can anyone recommend good resources...", "replies": 3, "created_at": "2024-01-02T00:00:00Z"}], "total": 2}';
            add_header Content-Type application/json;
        }

        if ($request_method = POST) {
            return 201 '{"id": 3, "title": "New Discussion", "author": "New User", "content": "This is a new discussion", "replies": 0, "created_at": "2024-01-03T00:00:00Z", "created": true}';
            add_header Content-Type application/json;
        }
    }

    # Groups endpoints
    location /api/v1/groups {
        if ($request_method = OPTIONS) {
            add_header Access-Control-Allow-Origin "*";
            add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS";
            add_header Access-Control-Allow-Headers "Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Authorization";
            add_header Access-Control-Max-Age 3600;
            add_header Content-Length 0;
            add_header Content-Type text/plain;
            return 204;
        }

        if ($request_method = GET) {
            return 200 '{"groups": [{"id": 1, "name": "Beginner Kanji Learners", "description": "A group for beginners learning kanji", "members": 25, "created_at": "2024-01-01T00:00:00Z"}, {"id": 2, "name": "Advanced Japanese", "description": "For advanced learners", "members": 15, "created_at": "2024-01-02T00:00:00Z"}], "total": 2}';
            add_header Content-Type application/json;
        }

        if ($request_method = POST) {
            return 201 '{"id": 3, "name": "New Group", "description": "A new study group", "members": 1, "created_at": "2024-01-03T00:00:00Z", "created": true}';
            add_header Content-Type application/json;
        }
    }

    # Leaderboard endpoints
    location /api/v1/leaderboard {
        if ($request_method = OPTIONS) {
            add_header Access-Control-Allow-Origin "*";
            add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS";
            add_header Access-Control-Allow-Headers "Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Authorization";
            add_header Access-Control-Max-Age 3600;
            add_header Content-Length 0;
            add_header Content-Type text/plain;
            return 204;
        }

        if ($request_method = GET) {
            return 200 '{"leaderboard": [{"rank": 1, "user_id": 1, "username": "John Doe", "score": 1500, "level": 10}, {"rank": 2, "user_id": 2, "username": "Jane Smith", "score": 1400, "level": 9}, {"rank": 3, "user_id": 3, "username": "Bob Wilson", "score": 1300, "level": 8}], "total": 3}';
            add_header Content-Type application/json;
        }
    }

    # Default location
    location / {
        return 200 '{"message": "Community Service", "endpoints": ["/health", "/api/v1/community", "/api/v1/discussions", "/api/v1/groups", "/api/v1/leaderboard"]}';
        add_header Content-Type application/json;
    }
}
