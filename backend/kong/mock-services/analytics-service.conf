server {
    listen 80;
    server_name localhost;

    # Health check endpoint
    location /health {
        access_log off;
        return 200 '{"status": "healthy", "timestamp": "$time_iso8601", "service": "analytics-service"}';
        add_header Content-Type application/json;
    }

    # Analytics endpoints
    location /api/v1/analytics {
        if ($request_method = OPTIONS) {
            add_header Access-Control-Allow-Origin "*";
            add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS";
            add_header Access-Control-Allow-Headers "Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Authorization";
            add_header Access-Control-Max-Age 3600;
            add_header Content-Length 0;
            add_header Content-Type text/plain;
            return 204;
        }

        if ($request_method = GET) {
            return 200 '{"analytics": {"total_users": 1000, "active_users": 150, "total_sessions": 5000, "average_session_duration": 1800, "completion_rate": 85, "popular_characters": ["一", "あ", "ア"]}}';
            add_header Content-Type application/json;
        }

        if ($request_method = POST) {
            return 201 '{"event": "user_action", "user_id": 1, "action": "character_completed", "character": "一", "timestamp": "2024-01-01T00:00:00Z", "recorded": true}';
            add_header Content-Type application/json;
        }
    }

    # Metrics endpoints
    location /api/v1/metrics {
        if ($request_method = OPTIONS) {
            add_header Access-Control-Allow-Origin "*";
            add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS";
            add_header Access-Control-Allow-Headers "Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Authorization";
            add_header Access-Control-Max-Age 3600;
            add_header Content-Length 0;
            add_header Content-Type text/plain;
            return 204;
        }

        if ($request_method = GET) {
            return 200 '{"metrics": {"requests_per_minute": 150, "average_response_time": 250, "error_rate": 0.02, "uptime": 99.9, "memory_usage": 512, "cpu_usage": 45}}';
            add_header Content-Type application/json;
        }
    }

    # Reports endpoints
    location /api/v1/reports {
        if ($request_method = OPTIONS) {
            add_header Access-Control-Allow-Origin "*";
            add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS";
            add_header Access-Control-Allow-Headers "Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, Authorization";
            add_header Access-Control-Max-Age 3600;
            add_header Content-Length 0;
            add_header Content-Type text/plain;
            return 204;
        }

        if ($request_method = GET) {
            return 200 '{"reports": [{"id": 1, "title": "Daily Usage Report", "type": "usage", "period": "2024-01-01", "data": {"users": 150, "sessions": 300, "completions": 250}}, {"id": 2, "title": "Weekly Progress Report", "type": "progress", "period": "2024-01-01 to 2024-01-07", "data": {"new_users": 25, "active_users": 120, "completion_rate": 85}}], "total": 2}';
            add_header Content-Type application/json;
        }

        if ($request_method = POST) {
            return 201 '{"id": 3, "title": "Custom Report", "type": "custom", "period": "2024-01-01", "data": {"custom_metric": 100}, "created": true}';
            add_header Content-Type application/json;
        }
    }

    # Default location
    location / {
        return 200 '{"message": "Analytics Service", "endpoints": ["/health", "/api/v1/analytics", "/api/v1/metrics", "/api/v1/reports"]}';
        add_header Content-Type application/json;
    }
}
